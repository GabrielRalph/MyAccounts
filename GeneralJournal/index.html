<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script type = "module" src = "../MyLoader/my-loader.js"></script>
    <script type = "module" src = "../FireUser/fire-user.js"></script>
    <script type = "module" src = "./general-journal.js"></script>
    <script type = "module" src = "./EntryForm.js"></script>
    <link href = "./gj-styles.css" rel="stylesheet" />
    <link href = "../InputPlus/input.css" rel="stylesheet" />
  </head>
  <body>
    <fire-user users-ref = "generalJournal/users/">
      <div name = "loader">
        <my-loader></my-loader>
      </div>

      <template name = "no-user">
        <div class = "user-bar">
          <div class = "btn" signin>
            Sign in
          </div>
        </div>
      </template>

      <template name = "user">
        <div class = "user-bar">
          <div>
            Hey {{displayName}}
          </div>
          <img src="{{photoURL}}" />
          <div class = "btn" signout>
            Sign out
          </div>
        </div>

        <general-journal></general-journal>
        <entry-form></entry-form>
      </template>

      <template name = "config">
        {
          "apiKey": "AIzaSyAwKRqxNdoO05hLlGZwb5AgWugSBzruw6A",
          "authDomain": "myaccounts-4a6c7.firebaseapp.com",
          "databaseURL": "https://myaccounts-4a6c7-default-rtdb.asia-southeast1.firebasedatabase.app",
          "projectId": "myaccounts-4a6c7",
          "storageBucket": "myaccounts-4a6c7.appspot.com",
          "messagingSenderId": "678570989696",
          "appId": "1:678570989696:web:ca70c09476d4c5f627ee65"
        }
      </template>
    </fire-user>
  </body>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cutive+Mono&display=swap');
    body{
      font-family: 'Cutive Mono', monospace;
      margin: 1em;
      overflow: hidden;
      position: fixed;
      font-size: 16pt;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    /* fire-user {height: 100%;display: block; position: relative;} */

    general-journal {
      overflow: scroll;
      position: absolute;
      top: 2em;
      left: 0;
      right: calc(30% + 1em);
      bottom: 0;
    }
    entry-form {
      width: 100%;
      display: table;
      overflow: scroll;
      position: absolute;
      top: 2em;
      left: 70%;
      right: 0;
      bottom: 0;
    }
    entry-form td {
      padding-top: 1em;
    }
    /* #open-filter {
    }

    .mobile #control-bar {
      bottom: 0;
      font-size: 1.5em;
    }
    body:not(.mobile) #control-bar {
      top: 0;
      font-size: 1em;
    }

    #control-bar {
      position: fixed;
      left: 0;
      right: 0;
      padding: 0.5em;
      background: #fff8;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 2;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }
    #control-bar span {
      display: flex;
      align-items: center;
      border-radius: 3em;
      padding: 0.2em 0.4em;
    }


    #sign-in {
      cursor: pointer;
    }

    #journal {
      z-index: 1;
    }
    #journal, #form{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: scroll;
      padding: calc(2em + (100vw - 100vmin) / 2.25);
      padding-bottom: 6em;
      padding-top: 2em;
    }

    .mobile #journal {
      padding-bottom: 6em;
      padding-top: 2em;
    }
    body:not(.mobile) #journal {
      padding-bottom: 2em;
      padding-top: 4em;
    }

    #form {
      background: #fff2;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: 0.4s cubic-bezier(0.4, 0, 0.6, 1) opacity;
      opacity: 0;
      pointer-events: none;
      padding: 2em;
      z-index: 3;
    }
    .mobile #form {
      font-size: max(1em, 42px);
    }


    .icon {
      height: 1em;
      cursor: pointer;
      vertical-align: middle;
      border-radius: 1em;
    }


    #form .icon {
      height: 2em;
      margin-top: 2em;
    }

    #form .icon:nth-of-type(2n + 1){
      float: right;
      margin-left: 1.5em;
    }
    .placeholder p {
      display: inline;
    }

    .entry-form tr td:nth-of-type(2) {
      width: 20%;
    }
    .entry-form td {
      padding-top: 1em;
    } */
  </style>
  <script>
    let fireuser = document.querySelector("body > fire-user");

    fireuser.addEventListener("user", async () => {
      let gj = document.getElementsByTagName("general-journal")[0];
      let update = (sc) => {
        gj.addEntry(sc.key, sc.val());
        fireuser.loaded = true;
      }
      fireuser.onChildAdded("journal", update);
      fireuser.onChildChanged("journal", update);
      fireuser.onChildRemoved("journal", (sc) => gj.removeEntry(sc.key));
    })

  </script>
</html>
